!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=n(5),u=r(o),i=n(4),f=r(i),a=n(2),c=r(a),l=n(3),d=r(l),s=(0,c.default)(process.stdin);(0,u.default)(s,f.default,d.default)},function(t,e){"use strict";function n(){var t=[];return{register:function(e){t.push(e)},notify:function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];t.forEach(function(t){return t.apply(void 0,n)})}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){var e={},n=function(){return(0,a.default)(function(t,n){var r=n.name;r in e&&e[r].notify(n)},50)};return{init:function(){return t.on("keypress",n()),this},register:function(t,n){return e[t]=e[t]||(0,i.default)(),e[t].register(n),this},onKeyLeft:function(t){return this.register(c,t)},onKeyRight:function(t){return this.register(l,t)},onKeyUp:function(t){return this.register(d,t)},onKeyDown:function(t){return this.register(s,t)}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var u=n(1),i=r(u),f=n(12),a=r(f),c="left",l="right",d="up",s="down"},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){var e=u();t.onUpdate(function(t){return e.render(t)}),e.render(t.state)}function u(){function t(t){var n=t.tetris,r=t.clearing,o=f(c(c({},n,{clearing:r}))),u=a(c({},n));return e.append(o),e.append(u),e}var e=d.default.screen({smartCSR:!0});return e.key(["escape","q","C-c"],function(){return process.exit(0)}),{render:function(e){t(e).render()}}}function i(t,e,n,r){var o={1:"#008B8B",2:"#FFFF00",3:"#800080",4:"#1E90FF",5:"#FF8C00",6:"#008000",7:"#B22222"};return d.default.box({top:e,left:2*n,width:2,height:1,content:r?"▒▒":"",style:{fg:"#fff",bg:o[t]}})}function f(t){var e=t.board,n=t.landing,r=t.lost,o=t.clearing,u=2*e.width+2,a=e.height+2,c=d.default.box({top:"center",left:"50%-"+u,width:u,height:a,border:{type:"bg"},style:{fg:"#fff",bg:"#000",border:{fg:"#fff",bg:"#fff"}}});if(r)return c.append(f.GameOver(u-2,a-2)),c;var l=n?e.land(n):e,s=l.landed.reduce(function(t,e,n){var r=o&&e.full,u=e.cells.map(function(t,e){return t?i(t,n,e,r):null});return t.concat(u.filter(function(t){return!!t}))},[]);return s.forEach(function(t){return c.append(t)}),c}function a(t){var e=t.level,n=t.score,r=t.totalLinesCleared,o=t.tetrominoStream,u=d.default.box({top:"center",left:"50%+2",width:20,height:16});return u.append(a.ScoreLabel(n)),u.append(a.LinesLabel(r)),u.append(a.LevelLabel(e)),u.append(a.NextTetromino(o.peek())),u}Object.defineProperty(e,"__esModule",{value:!0});var c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};e.default=o;var l=n(11),d=r(l);f.GameOver=function(t,e){var n=d.default.box({top:0,left:0,width:t,height:e,style:{bg:"#f00"}});return n.append(d.default.text({top:"center",left:"center",tags:!0,content:"{bold}GAME OVER{/bold}",style:{bg:"#f00"}})),n},a.ScoreLabel=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d.default.text({top:n,left:e,tags:!0,content:"{bold}Score:{/bold} "+t})},a.LinesLabel=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return d.default.text({top:n,left:e,tags:!0,content:"{bold}Lines:{/bold} "+t})},a.LevelLabel=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return d.default.text({top:n,left:e,tags:!0,content:"{bold}Level:{/bold} "+t})},a.NextTetromino=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=d.default.box({top:n,left:e,width:10,height:6,style:{fg:"#fff",border:{fg:"#f00"}}});return r.append(d.default.text({tags:!0,content:"{bold}Next:{/bold}"})),t.forEach(function(t){var e=t.value,n=t.row,o=t.col;r.append(i(e,n+2,o))}),r}},function(t,e){"use strict";function n(t){return new Promise(function(e){setTimeout(e,t)})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){var r=a.default.empty(10,20),o=i.default.Stream.Random(),u=o.next().moveBy(0,3),f=(0,l.default)(r,u,o),c=(0,s.default)(t,e,f);n(c),c.start()}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var u=n(10),i=r(u),f=n(6),a=r(f),c=n(9),l=r(c),d=n(7),s=r(d)},function(t,e){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function r(t,e,n){return{landed:n,width:t,height:e,get fullLines(){return n.filter(function(t){return t.full}).length},collides:function(r){var o=function(n){var r=n.row,o=n.col;return o<0||o>t-1||r>e-1||r<0},u=function(t){var e=t.row,r=t.col;return!!n[e].cell(r).get()};return r.some(function(t){return o(t)||u(t)})},land:function(o){var u=n.map(function(t){return t.clone()});return o.forEach(function(t){var e=t.value,n=t.row,r=t.col;u[n]=u[n].cell(r).set(e)}),r(t,e,u)},clearLines:function(){var o=n.reduce(function(e,n){return n.full?[r.Row.empty(t)].concat(e):e.concat([n])},[]);return r(t,e,o)}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r,r.empty=function(t,e){return r(t,e,new Array(e).fill(0).map(function(e){return r.Row.empty(t)}))},r.Row=function(t){return{cells:t,size:t.length,full:t.every(function(t){return!!t}),cell:function(e){return{get:function(){return t[e]},set:function(o){var u=[].concat(n(t.slice(0,e)),[o],n(t.slice(e+1)));return r.Row(u)}}},clone:function(){return r.Row(t.map(function(t){return t}))},map:function(e){return r.Row(t.map(e))}}},r.Row.empty=function(t){return r.Row(new Array(t).fill(0))}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){var r={tetris:n},o=1e3,i=(0,f.default)(),a=function(t){return r=u({},r,t),i.notify(r),r},c=function(t){var e=t.x,n=t.y;return function(t){return t.moveBy(n,e)}},l=function(){return function(t){return t.rotate()}},d=function(t,e){var n=t.tetris;return{tetris:n.spawn(e(n.landing))}},s=function t(){var n=r,u=n.tetris,i=u.step();return i.totalLinesCleared>u.totalLinesCleared?(a({clearing:!0}),void e(o).then(function(){return a({tetris:i,clearing:!1})}).then(function(){return e(o*i.speed)}).then(t)):i.lost?void a({tetris:i}):(a({tetris:i}),void e(o*i.speed).then(t))};return{state:r,onUpdate:function(t){i.register(t)},start:function(){var n=function(t){var e=t.x,n=void 0===e?0:e,o=t.y,u=void 0===o?0:o;return function(){var t=u===-1?d(r,l()):d(r,c({x:n,y:u}));a(t)}};t.init().onKeyLeft(n({x:-1})).onKeyRight(n({x:1})).onKeyUp(n({y:-1})).onKeyDown(n({y:1})),e(o).then(s)}}}Object.defineProperty(e,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};e.default=o;var i=n(1),f=r(i)},function(t,e){"use strict";function n(t){var e=t,n=2147483648,r=1103515245,o=12345,u=function(){return(r*e+o)%n};return{next:function(){return e=u()},peek:function(){return u()}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e){"use strict";function n(t,e,o){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=Math.floor(u/10),c=Math.max(-1/30*a+1,.3),l=function(){return n(t,e,o,u,i,!0)};return{board:t,landing:e,level:a,speed:c,score:i,lost:f,tetrominoStream:o,totalLinesCleared:u,spawn:function(e){return f?this:t.collides(e)?this:n(t,e,o,u,i)},step:function(){var f=e.fall(),c=t.collides(f);if(!c)return n(t,f,o,u,i);if(e.row<=1)return l();var d=o.next().moveBy(0,3),s=t.land(e),v=s.fullLines,p=i+r(a,v);return n(s.clearLines(),d,o,u+v,p)}}}function r(t,e){var n=function(e){return e*(t+1)};switch(e){case 1:return n(40);case 2:return n(100);case 3:return n(300);case 4:return n(1200)}return 0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n,e.calcScore=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],u=function(t){return t%r.length},i=function(){return u(n+1)},a=function(n){return f(n.value)(t+n.row,e+n.col)},c=r[u(n)];return{row:t,col:e,shape:c,moveBy:function(u,i){return o(t+u,e+i,n,r)},fall:function(){return this.moveBy(1,0)},rotate:function(){return o(t,e,i(),r)},some:function(t){return c.some(function(e){return t(a(e))})},forEach:function(t){c.forEach(function(e){return t(a(e))})}}}Object.defineProperty(e,"__esModule",{value:!0}),e.Block=void 0,e.default=o;var u=n(8),i=r(u),f=e.Block=function(t){return function(e,n){return{value:t,row:e,col:n}}};o.I=function(t,e,n){var r=f(1),u=[[r(1,0),r(1,1),r(1,2),r(1,3)],[r(0,2),r(1,2),r(2,2),r(3,2)],[r(2,0),r(2,1),r(2,2),r(2,3)],[r(0,1),r(1,1),r(2,1),r(3,1)]];return o(t,e,n,u)},o.O=function(t,e,n){var r=f(2),u=[[r(1,1),r(1,2),r(2,1),r(2,2)]];return o(t,e,n,u)},o.T=function(t,e,n){var r=f(3),u=[[r(0,1),r(1,0),r(1,1),r(1,2)],[r(0,1),r(1,1),r(1,2),r(2,1)],[r(1,0),r(1,1),r(1,2),r(2,1)],[r(0,1),r(1,0),r(1,1),r(2,1)]];return o(t,e,n,u)},o.J=function(t,e,n){var r=f(4),u=[[r(0,0),r(1,0),r(1,1),r(1,2)],[r(0,1),r(0,2),r(1,1),r(2,1)],[r(1,0),r(1,1),r(1,2),r(2,2)],[r(0,1),r(1,1),r(2,0),r(2,1)]];return o(t,e,n,u)},o.L=function(t,e,n){var r=f(5),u=[[r(1,0),r(1,1),r(1,2),r(0,2)],[r(0,1),r(1,1),r(2,1),r(2,2)],[r(1,0),r(1,1),r(1,2),r(2,0)],[r(0,0),r(0,1),r(1,1),r(2,1)]];return o(t,e,n,u)},o.S=function(t,e,n){var r=f(6),u=[[r(1,1),r(1,2),r(2,0),r(2,1)],[r(0,1),r(1,1),r(1,2),r(2,2)]];return o(t,e,n,u)},o.Z=function(t,e,n){var r=f(7),u=[[r(1,0),r(1,1),r(2,1),r(2,2)],[r(0,2),r(1,1),r(1,2),r(2,1)]];return o(t,e,n,u)},o.Stream=function(t){var e=(0,i.default)(~~t),n=[o.I,o.O,o.T,o.J,o.L,o.S,o.Z],r=function(t){return n[t%n.length]()};return{next:function(){return r(e.next())},peek:function(){return r(e.peek())}}},o.Stream.Random=function(){var t=Math.floor(99999*Math.random());return o.Stream(t)}},function(t,e){t.exports=require("blessed")},function(t,e){t.exports=require("lodash.throttle")}]);